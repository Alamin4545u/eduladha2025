<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cash Box Pro</title>
    <!-- Telegram Web App script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase Apps (compat versions used to match original) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary-color: #007bff;
            --text-color: #333;
            --light-text: #777;
            --accent-color: #8a2be2;
            --btn-secondary-bg: #6c757d;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0 0 70px 0; background-color: var(--bg-color); color: var(--text-color);
            -webkit-user-select: none; -ms-user-select: none; user-select: none;
        }
        .container { padding: 15px; }
        .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
        .user-info { display:flex; align-items:center; }
        .avatar { width:45px; height:45px; border-radius:50%; background-color:var(--accent-color); color:white; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:20px; margin-right:10px; }
        .user-details h4, .user-details p { margin:0; }
        .user-details h4 { font-size:16px; }
        .user-details p { font-size:13px; color:var(--light-text); }
        .balance { text-align:right; }
        .balance p { margin:0; color:var(--light-text); font-size:14px; }
        .balance h3 { margin:0; color:var(--primary-color); font-size:22px; }
        .welcome-banner { background:linear-gradient(135deg,#e0f7fa,#b2ebf2); border-radius:12px; padding:20px; text-align:left; margin-bottom:20px; }
        .stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px; }
        .stat-card, .card { background-color:var(--card-bg); border-radius:12px; padding:15px; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
        .progress-bar { width:100%; background-color:#e0e0e0; border-radius:8px; height:8px; overflow:hidden; margin-top:10px; }
        .progress-bar-inner { height:100%; background-color:var(--primary-color); border-radius:8px; transition:width .3s ease; }
        .referral-link { background-color:#e9ecef; padding:12px; border-radius:8px; word-wrap:break-word; font-family:monospace; margin-bottom:10px; text-align:center; display:flex; gap:8px; align-items:center; justify-content:center; }
        .btn { display:inline-block; padding:10px 12px; border:none; border-radius:8px; background-color:var(--primary-color); color:white; font-size:15px; font-weight:bold; cursor:pointer; text-decoration:none; }
        .btn-secondary { background-color:var(--btn-secondary-bg); }
        .btn.small { padding:6px 8px; font-size:13px; }
        .task-card { margin-bottom:15px; }
        .page { display:none; }
        .page.active { display:block; }
        .bottom-nav { position:fixed; bottom:0; left:0; right:0; display:flex; justify-content:space-around; background-color:var(--card-bg); box-shadow:0 -2px 10px rgba(0,0,0,0.1); padding:5px 0; border-top:1px solid #eee; z-index:100; }
        .nav-item { display:flex; flex-direction:column; align-items:center; justify-content:center; color:var(--light-text); padding:5px 15px; cursor:pointer; border-radius:10px; transition:background-color .3s, color .3s; }
        .nav-item.active { color:var(--primary-color); }
        .form-group { margin-bottom:15px; }
        .history-item { padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
        .modal { display:none; position:fixed; z-index:1001; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.6); align-items:center; justify-content:center; }
        .modal-content { background-color:#fefefe; margin:auto; padding:20px; border-radius:12px; width:85%; max-width:400px; text-align:center; }
    </style>
</head>
<body>

    <!-- Pages -->
    <div id="home-page" class="page active">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <div class="avatar" id="user-avatar">?</div>
                    <div class="user-details">
                        <h4 id="user-name">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h4>
                        <p id="user-username">@‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                </div>
                <div class="balance">
                    <p>‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                    <h3 id="available-balance">‡ß≥‡ß¶.‡ß¶‡ß¶</h3>
                </div>
            </div>

            <div class="welcome-banner">
                <h2>üëã ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
                <p>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡¶§‡ßá ‡¶ï‡¶æ‡¶ú‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><p>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p><h3 id="total-earnings">‡ß≥‡ß¶.‡ß¶‡ß¶</h3></div>
                <div class="stat-card"><p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</p><h3 id="referrals">‡ß¶</h3></div>
                <div class="stat-card full-width"><p>‡¶Ö‡¶∞‡ßç‡¶ú‡¶ø‡¶§ ‡¶ï‡¶Æ‡¶ø‡¶∂‡¶®</p><h3>‡ß≥‡ß¶.‡ß¶‡ß¶</h3></div>
            </div>

            <div class="card">
                <h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</h3>
                <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ‡ß´‡ß¶‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®</p>
                <div class="progress-bar"><div id="daily-progress-bar" class="progress-bar-inner" style="width:0"></div></div>
                <small id="daily-progress-text">‡¶Ü‡¶ú: ‡ß¶/‡ß´‡ß¶</small>
            </div>

            <br>

            <div class="card">
                <h3>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="referral-item"><span>üéÅ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶∞‡¶æ ‡¶™‡¶æ‡¶¨‡ßá <strong id="join-bonus-text">‡ß®‡ß¶ ‡ß≥</strong> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div>
                <div class="referral-item"><span>üíµ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá <strong id="ref-bonus-text">‡ß´ ‡ß≥</strong> ‡¶™‡¶æ‡¶¨‡ßá‡¶®</span></div>

                <p style="margin-top:15px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:</p>
                <div class="referral-link" id="referral-link">
                    <a id="referral-anchor" href="#" target="_blank" style="text-decoration:none;color:inherit;word-break:break-all;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</a>
                </div>

                <div style="display:flex; gap:8px;">
                    <button class="btn" id="share-btn">‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn small btn-secondary" id="copy-ref-btn">‡¶ï‡¶™‡¶ø</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tasks-page" class="page">
        <div class="container">
            <h2>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® üéÅ</h2>
            <div class="task-card">
                <div class="task-header"><div><h4>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h4></div><span class="reward" id="ad-reward-text">‡ß≥‡ß¶.‡ß´‡ß¶</span></div>
                <div class="task-body"><p>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ‡¶õ‡ßã‡¶ü ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p></div>
                <button class="btn" id="watch-ad-btn">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
            </div>
            <div id="survey-tasks-container"></div>
        </div>
    </div>

    <div id="support-page" class="page" style="text-align:center; padding-top:50px;">
        <div class="container">
            <svg style="width:80px; height:80px; color:var(--primary-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            <h2>‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®?</h2>
            <p>‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p><br>
            <button id="contact-support-btn" class="btn">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="withdraw-page" class="page">
        <div class="container">
            <h2>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h2>
            <div class="card">
                <h4>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ</h4>
                <div><label>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ <span id="min-withdraw-req-text">‡ßß‡ßß‡ß¶</span> ‡ß≥ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (<span id="balance-progress-text">‡ß¶/‡ßß‡ßß‡ß¶</span>)</label>
                <div class="progress-bar"><div class="progress-bar-inner" id="balance-progress-bar" style="width:0"></div></div></div>
            </div>

            <div id="withdraw-requirement-notice" class="card" style="margin-top:15px; background-color:#ffebee; color:#c62828; text-align:center;">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ßß‡ßß‡ß¶ ‡ß≥ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§</div>

            <div class="card" style="margin-top:15px;">
                <div class="form-group">
                    <label for="payment-method">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</label>
                    <div class="payment-method">
                        <img id="payment-logo" src="" class="logo" style="width:28px; height:28px; margin-right:8px; vertical-align:middle;">
                        <select id="payment-method"></select>
                    </div>
                </div>
                <div class="form-group"><label for="account-number">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø</label><input type="text" id="account-number" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></div>
                <div class="form-group"><label for="amount">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label><input type="number" id="amount" placeholder="‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ‡ßß‡ßß‡ß¶.‡ß¶‡ß¶, ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö: ‡ß®‡ß¶‡ß¶‡ß¶.‡ß¶‡ß¶"></div>
                <button id="submit-withdraw-btn" class="btn">‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>

            <div class="card" style="margin-top:15px;"><h4>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h4><div id="withdrawal-history"><p style="text-align:center;color:var(--light-text);">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p></div></div>
        </div>
    </div>

    <!-- VPN Check Modal -->
    <div id="vpn-modal" class="modal"><div class="modal-content"><h3>VPN ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</h3><p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶§‡ßá, ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¶‡ßá‡¶∂‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø‡¶∞ VPN ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá:</p><strong id="allowed-countries-list">US, UK, CA</strong><br><br><button id="close-vpn-modal-btn" class="btn btn-secondary">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-page="home-page"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg><span>‡¶π‡ßã‡¶Æ</span></div>
        <div class="nav-item" data-page="tasks-page"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></div>
        <div class="nav-item" data-page="support-page"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg><span>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</span></div>
        <div class="nav-item" data-page="withdraw-page"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 6a2 2 0 00-2 2v2a2 2 0 002 2h12a2 2 0 002-2v-2a2 2 0 00-2-2H4z" clip-rule="evenodd"></path></svg><span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span></div>
    </nav>

<script>
    // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ---
    const firebaseConfig = {
        apiKey: "AIzaSyBidXnyxl4LjnRW6z5PrQ_iOKzqjjrxRtM",
        authDomain: "comexaple.firebaseapp.com",
        projectId: "comexaple",
        storageBucket: "comexaple.appspot.com",
        messagingSenderId: "799294329351",
        appId: "1:799294329351:web:0bb9620bc1d227a29650a2",
        measurementId: "G-LRBREF5QV6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Telegram WebApp object
    const tg = window.Telegram ? window.Telegram.WebApp : null;

    document.addEventListener('DOMContentLoaded', function () {
        if (tg && typeof tg.ready === 'function') tg.ready();

        let currentUserData = {};
        let appSettings = {};
        let teleUser = null;

        // Try to get Telegram user from initDataUnsafe if available
        try {
            const unsafe = (tg && tg.initDataUnsafe) ? tg.initDataUnsafe : null;
            const userFromTG = unsafe && unsafe.user ? unsafe.user : null;
            if (!userFromTG || Object.keys(userFromTG).length === 0) {
                teleUser = { id: '5788008001', first_name: 'Test', last_name: 'User', username: 'testuser' };
                console.warn("‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§");
            } else {
                teleUser = userFromTG;
            }
        } catch (e) {
            teleUser = { id: '5788008001', first_name: 'Test', last_name: 'User', username: 'testuser' };
            console.warn("TG init error, using test user.", e);
        }

        // Default app settings (will be overwritten if DB has config)
        function defaultSettings() {
            return {
                minWithdraw: 110,
                referralBonus: 5,
                joinBonus: 20,
                adReward: 0.50,
                surveyReward: 1.0,
                surveyAdsNeeded: 10,
                supportLink: 'https://t.me/your_support_contact',
                botUsername: 'YourBotName_bot',
                gigapubAppId: "4203",
                vpnCheckEnabled: true,
                allowedCountries: "US,UK,CA",
                paymentMethods: [
                    { name: '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂', logo: 'https://i.ibb.co/L0f5bXN/bkash.png' },
                    { name: '‡¶®‡¶ó‡¶¶', logo: 'https://i.ibb.co/qYdG2sW/nagad.png' }
                ],
                maxWithdraw: 2000
            };
        }

        // Initialize app: load settings -> load payments -> load user data
        async function initializeApp() {
            try {
                appSettings = defaultSettings();
                const settingsDoc = await db.collection('settings').doc('appConfig').get().catch(()=>null);
                if (settingsDoc && settingsDoc.exists) {
                    appSettings = Object.assign({}, appSettings, settingsDoc.data());
                }
                loadGigapubScript(appSettings.gigapubAppId);
                loadPaymentMethods(appSettings.paymentMethods);
                await loadUserData(); // this will call updateUI internally
            } catch (error) {
                console.error("Initialization error:", error);
                if (tg && tg.showAlert) tg.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
        }

        function loadGigapubScript(appId) {
            if (!appId) return;
            if (document.querySelector(`script[src*="${appId}"]`)) return;
            const script = document.createElement('script');
            script.src = `https://ad.gigapub.tech/script?id=${encodeURIComponent(appId)}`;
            document.body.appendChild(script);
        }

        function loadPaymentMethods(methods) {
            const select = document.getElementById('payment-method');
            if (!select) return;
            select.innerHTML = '';
            (methods || []).forEach(method => {
                const option = document.createElement('option');
                option.value = method.name;
                option.textContent = method.name;
                option.dataset.logo = method.logo || '';
                select.appendChild(option);
            });
            updatePaymentMethodUI();
        }

        async function loadUserData() {
            // set UI basic user info
            const fullName = `${teleUser.first_name || ''} ${teleUser.last_name || ''}`.trim();
            document.getElementById('user-name').textContent = fullName || 'User';
            document.getElementById('user-username').textContent = teleUser.username ? `@${teleUser.username}` : 'N/A';
            document.getElementById('user-avatar').textContent = (fullName[0] || '?').toUpperCase();

            const userRef = db.collection('users').doc(String(teleUser.id));
            const doc = await userRef.get().catch(()=>null);

            if (!doc || !doc.exists) {
                const initialSurveyProgress = {};
                for (let i = 1; i <= 10; i++) initialSurveyProgress[`survey_${i}`] = 0;
                const initialData = {
                    username: teleUser.username || null,
                    fullName: fullName,
                    balance: appSettings.joinBonus || 0,
                    totalEarnings: appSettings.joinBonus || 0,
                    referrals: 0,
                    adsWatchedToday: 0,
                    lastAdWatch: null,
                    surveyProgress: initialSurveyProgress
                };
                await userRef.set(initialData);
                const newDoc = await userRef.get();
                currentUserData = newDoc.data();
            } else {
                currentUserData = doc.data();
            }

            // Update UI now that we have both appSettings and currentUserData
            updateUI(currentUserData);
            loadWithdrawalHistory();
        }

        function buildReferralLink() {
            // Ensure bot username exists and has no leading @
            let bot = (appSettings && appSettings.botUsername) ? String(appSettings.botUsername).trim() : 'YourBotName_bot';
            if (bot.startsWith('@')) bot = bot.slice(1);
            // Use deep-link start parameter with user id (you can change pattern if your bot expects different)
            const link = `https://t.me/${encodeURIComponent(bot)}?start=${encodeURIComponent(String(teleUser.id))}`;
            return link;
        }

        function updateUI(data) {
            // balance / totals
            document.getElementById('available-balance').textContent = `‡ß≥${(data.balance || 0).toFixed(2)}`;
            document.getElementById('total-earnings').textContent = `‡ß≥${(data.totalEarnings || 0).toFixed(2)}`;
            document.getElementById('referrals').textContent = data.referrals || 0;

            document.getElementById('join-bonus-text').textContent = `${appSettings.joinBonus} ‡ß≥`;
            document.getElementById('ref-bonus-text').textContent = `${appSettings.referralBonus} ‡ß≥`;
            document.getElementById('ad-reward-text').textContent = `‡ß≥${(appSettings.adReward || 0).toFixed(2)}`;

            // daily progress
            const adsWatched = data.adsWatchedToday || 0;
            const progressPct = Math.min((adsWatched / 50) * 100, 100);
            document.getElementById('daily-progress-bar').style.width = `${progressPct}%`;
            document.getElementById('daily-progress-text').textContent = `‡¶Ü‡¶ú: ${adsWatched}/50`;

            // referral link
            const referralAnchor = document.getElementById('referral-anchor');
            const rlink = buildReferralLink();
            referralAnchor.href = rlink;
            referralAnchor.textContent = rlink;

            updateWithdrawUI(data.balance || 0);
            renderSurveyTasks(data.surveyProgress || {});
        }

        function updateWithdrawUI(balance) {
            const minBalance = appSettings.minWithdraw || 110;
            const balanceProgress = Math.min((balance / minBalance) * 100, 100);
            document.getElementById('min-withdraw-req-text').textContent = minBalance;
            document.getElementById('balance-progress-text').textContent = `${Math.floor(balance)}/${minBalance}`;
            document.getElementById('balance-progress-bar').style.width = `${balanceProgress}%`;
            const amountInput = document.getElementById('amount');
            if (amountInput) amountInput.placeholder = `‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ${minBalance.toFixed(2)}, ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö: ${(appSettings.maxWithdraw || 2000).toFixed(2)}`;
            const withdrawNotice = document.getElementById('withdraw-requirement-notice');
            const submitBtn = document.getElementById('submit-withdraw-btn');
            if (balance >= minBalance) {
                withdrawNotice.style.display = 'none';
                if (submitBtn) submitBtn.disabled = false;
            } else {
                withdrawNotice.style.display = 'block';
                withdrawNotice.textContent = `‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ${minBalance} ‡ß≥ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`;
                if (submitBtn) submitBtn.disabled = true;
            }
        }

        function renderSurveyTasks(progress) {
            const container = document.getElementById('survey-tasks-container');
            container.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const currentProgress = progress[`survey_${i}`] || 0;
                const adsNeeded = appSettings.surveyAdsNeeded || 10;
                const isCompleted = currentProgress >= adsNeeded;
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card card';
                taskCard.style.marginBottom = '12px';
                taskCard.innerHTML = `
                    <div class="task-header" style="display:flex;justify-content:space-between;align-items:center;">
                        <div><h4 style="margin:0;">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶ï‡¶∞‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶® ${i}</h4></div>
                        <div style="font-weight:bold;color:var(--primary-color);">‡ß≥${(appSettings.surveyReward || 1).toFixed(2)}</div>
                    </div>
                    <div class="task-body"><p style="color:var(--light-text); margin:8px 0;">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ${adsNeeded}‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§ (${currentProgress}/${adsNeeded} ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®)</p></div>
                    <div style="text-align:right;"><button class="btn survey-btn" data-survey-id="${i}" ${isCompleted ? 'disabled' : ''}>${isCompleted ? '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®' : '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®'}</button></div>
                `;
                container.appendChild(taskCard);
            }
            document.querySelectorAll('.survey-btn').forEach(button => {
                button.addEventListener('click', () => handleAdWatchWithReward(appSettings.surveyReward, button.dataset.surveyId));
            });
        }

        async function checkVPN() {
            if (!appSettings.vpnCheckEnabled) return true;
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) throw new Error('Network response not ok');
                const data = await response.json();
                const userCountry = (data.country_code || '').toUpperCase();
                const allowed = (appSettings.allowedCountries || "US,UK,CA").split(',').map(s => s.trim().toUpperCase());
                if (allowed.includes(userCountry)) return true;
                document.getElementById('allowed-countries-list').textContent = appSettings.allowedCountries;
                document.getElementById('vpn-modal').style.display = 'flex';
                return false;
            } catch (error) {
                console.error("VPN check error:", error);
                if (tg && tg.showAlert) tg.showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return false;
            }
        }

        // Wrapper for showing Giga ad: original used window.showGiga
        async function showGigaAdIfAvailable() {
            if (typeof window.showGiga === 'function') {
                try {
                    await window.showGiga();
                    return true;
                } catch (e) {
                    console.warn("Giga ad closed or error:", e);
                    throw e;
                }
            } else {
                // If no Giga ad available, simulate a short delay and return success
                // (This ensures functionality when testing without the ad provider)
                await new Promise(r => setTimeout(r, 800));
                return true;
            }
        }

        async function handleAdWatchWithReward(reward, surveyId = null) {
            try {
                await showGigaAdIfAvailable();
                const userRef = db.collection('users').doc(String(teleUser.id));
                await db.runTransaction(async (transaction) => {
                    const userDoc = await transaction.get(userRef);
                    if (!userDoc.exists) throw new Error("User not found");
                    const data = userDoc.data();
                    const updates = {};
                    if (surveyId) {
                        const key = `surveyProgress.survey_${surveyId}`;
                        const current = (data.surveyProgress && data.surveyProgress[`survey_${surveyId}`]) ? data.surveyProgress[`survey_${surveyId}`] : 0;
                        const newVal = current + 1;
                        updates[key] = newVal;
                        const adsNeeded = appSettings.surveyAdsNeeded || 10;
                        if (newVal >= adsNeeded) {
                            updates.balance = (data.balance || 0) + (appSettings.surveyReward || 1);
                            updates.totalEarnings = (data.totalEarnings || 0) + (appSettings.surveyReward || 1);
                        }
                    } else {
                        updates.balance = (data.balance || 0) + (reward || appSettings.adReward || 0);
                        updates.totalEarnings = (data.totalEarnings || 0) + (reward || appSettings.adReward || 0);
                        updates.adsWatchedToday = (data.adsWatchedToday || 0) + 1;
                    }
                    transaction.update(userRef, updates);
                });
                if (tg && tg.HapticFeedback && tg.HapticFeedback.notificationOccurred) {
                    try { tg.HapticFeedback.notificationOccurred('success'); } catch {}
                }
                await loadUserData();
            } catch (e) {
                console.error("Ad or transaction error:", e);
                if (e && e.message === "Ad was closed by user") {
                    // do nothing or show mild alert
                    if (tg && tg.showAlert) tg.showAlert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡¶ü‡¶ø ‡¶™‡ßÅ‡¶∞‡ßã‡¶™‡ßÅ‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã ‡¶®‡¶æ‡•§");
                } else {
                    if (tg && tg.showAlert) tg.showAlert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                }
            }
        }

        document.getElementById('watch-ad-btn').addEventListener('click', () => handleAdWatchWithReward(appSettings.adReward));

        async function loadWithdrawalHistory() {
            const historyContainer = document.getElementById('withdrawal-history');
            historyContainer.innerHTML = '<p style="text-align:center;color:var(--light-text);">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            try {
                const q = await db.collection('withdrawals').where('userId', '==', teleUser.id).orderBy('timestamp', 'desc').limit(10).get();
                if (q.empty) {
                    historyContainer.innerHTML = '<p style="text-align:center;color:var(--light-text);">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
                    return;
                }
                historyContainer.innerHTML = '';
                q.forEach(doc => {
                    const data = doc.data();
                    const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('bn-BD') : 'N/A';
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `<div><strong>‡ß≥${(data.amount || 0).toFixed(2)}</strong> - ${data.method}<div style="font-size:12px;color:#777;">${date}</div></div><span class="status ${data.status || 'pending'}">${data.status || 'pending'}</span>`;
                    historyContainer.appendChild(item);
                });
            } catch (e) {
                console.error("Withdrawal history load error:", e);
                historyContainer.innerHTML = '<p style="text-align:center;color:var(--light-text);">‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§</p>';
            }
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', async () => {
                const pageId = item.dataset.page;
                if (pageId === 'tasks-page') {
                    const isVpnOk = await checkVPN();
                    if (!isVpnOk) return;
                }
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
            });
        });

        document.getElementById('close-vpn-modal-btn').addEventListener('click', () => {
            document.getElementById('vpn-modal').style.display = 'none';
        });

        // Sharing & copying referral link
        document.getElementById('share-btn').addEventListener('click', () => {
            const rlink = buildReferralLink();
            const shareText = `üí∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶™‡ßç‡¶∞‡ßã-‡¶§‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®!\n\n‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ${appSettings.joinBonus} ‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®!\n\n‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:\n${rlink}`;
            // Prefer Telegram share if webapp
            if (tg && tg.openTelegramLink) {
                tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(rlink)}&text=${encodeURIComponent(shareText)}`);
            } else {
                // fallback to navigator.share or clipboard
                if (navigator.share) {
                    navigator.share({ title: 'Join Cash Box Pro', text: shareText, url: rlink }).catch(()=>{});
                } else {
                    // copy to clipboard and notify
                    copyToClipboard(rlink);
                    if (tg && tg.showPopup) {
                        tg.showPopup({ title: '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', message: '‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚Äî ‡¶è‡¶ñ‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§', buttons:[{type:'close'}] });
                    } else {
                        alert('Referral link copied to clipboard.');
                    }
                }
            }
        });

        document.getElementById('copy-ref-btn').addEventListener('click', () => {
            const rlink = buildReferralLink();
            copyToClipboard(rlink);
            if (tg && tg.showPopup) {
                tg.showPopup({ title: '‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá', message: '‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', buttons:[{type:'close'}] });
            } else {
                alert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
            }
        });

        function copyToClipboard(text) {
            if (!text) return;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).catch(()=>{});
            } else {
                const ta = document.createElement('textarea');
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                try { document.execCommand('copy'); } catch (e) {}
                ta.remove();
            }
        }

        document.getElementById('contact-support-btn').addEventListener('click', () => {
            if (appSettings && appSettings.supportLink) {
                if (tg && tg.openTelegramLink) tg.openTelegramLink(appSettings.supportLink);
                else window.open(appSettings.supportLink, '_blank');
            } else {
                if (tg && tg.showAlert) tg.showAlert('‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§');
            }
        });

        // payment select change
        const paymentMethodSelect = document.getElementById('payment-method');
        if (paymentMethodSelect) paymentMethodSelect.addEventListener('change', updatePaymentMethodUI);
        function updatePaymentMethodUI() {
            const selectedOption = paymentMethodSelect.selectedOptions ? paymentMethodSelect.selectedOptions[0] : null;
            if (!selectedOption) return;
            const logo = selectedOption.dataset.logo || '';
            document.getElementById('payment-logo').src = logo;
            document.getElementById('account-number').placeholder = `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ${selectedOption.textContent} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®`;
        }

        // Withdraw submit
        document.getElementById('submit-withdraw-btn').addEventListener('click', async (e) => {
            e.currentTarget.disabled = true;
            try {
                const method = document.getElementById('payment-method').value;
                const number = document.getElementById('account-number').value.trim();
                const amount = parseFloat(document.getElementById('amount').value);
                if (!number || !amount || isNaN(amount)) {
                    if (tg && tg.showAlert) tg.showAlert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    e.currentTarget.disabled = false; return;
                }
                if (amount < appSettings.minWithdraw) {
                    if (tg && tg.showAlert) tg.showAlert(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ${appSettings.minWithdraw} ‡ß≥‡•§`);
                    e.currentTarget.disabled = false; return;
                }
                const userRef = db.collection('users').doc(String(teleUser.id));
                const doc = await userRef.get();
                const balance = (doc && doc.exists && doc.data().balance) ? doc.data().balance : 0;
                if (amount > balance) {
                    if (tg && tg.showAlert) tg.showAlert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§');
                    e.currentTarget.disabled = false; return;
                }
                await db.collection('withdrawals').add({
                    userId: teleUser.id,
                    username: teleUser.username || null,
                    amount: amount,
                    method: method,
                    number: number,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                await userRef.update({ balance: balance - amount });
                if (tg && tg.showPopup) {
                    tg.showPopup({ title: '‡¶∏‡¶´‡¶≤', message: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', buttons: [{ type: 'close' }] });
                } else {
                    alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                }
                await loadUserData();
                document.getElementById('account-number').value = '';
                document.getElementById('amount').value = '';
            } catch (err) {
                console.error("Withdraw error:", err);
                if (tg && tg.showAlert) tg.showAlert('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
            } finally {
                e.currentTarget.disabled = false;
            }
        });

        // Start app
        initializeApp();
    });
</script>
</body>
</html>
