<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Canada Discovery Quiz</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Premium Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- ðŸ”¥ MONETAG SDK (Zone: 10543114) ðŸ”¥ -->
    <script src='//libtl.com/sdk.js' data-zone='10543114' data-sdk='show_10543114'></script>

    <style>
        :root {
            --canada-red: #FF0000;
            --dark-bg: #0f0f0f;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            width: 100%;
            padding: 20px 0;
            background: var(--canada-red);
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 20px;
            letter-spacing: 2px;
        }

        .container {
            width: 90%;
            max-width: 400px;
            margin-top: 30px;
            padding: 20px;
            background: var(--glass);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .question-box {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 25px;
            min-height: 60px;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-btn:active {
            background: var(--canada-red);
            transform: scale(0.95);
        }

        /* Ad Overlay UI */
        #adOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .timer-circle {
            width: 120px;
            height: 120px;
            border: 5px solid var(--canada-red);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 40px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px var(--canada-red);
        }

        .status-text {
            color: #ccc;
            font-size: 14px;
            letter-spacing: 1px;
        }

        .score-box {
            margin-top: 20px;
            font-size: 12px;
            color: #888;
        }
    </style>
</head>
<body>

    <div class="header">CANADA QUIZ PRO</div>

    <div class="container" id="quizContainer">
        <div class="question-box" id="questionText">Loading question...</div>
        <div class="options-grid" id="optionsGrid">
            <!-- Options will load here -->
        </div>
        <div class="score-box">
            Score: <span id="scoreVal">0</span> | Points: <span id="pointsVal">0</span>
        </div>
    </div>

    <!-- Ad Phase Overlay -->
    <div id="adOverlay">
        <div class="status-text" id="phaseText">PREPARING...</div>
        <div class="timer-circle" id="timerDisplay">00</div>
        <div class="status-text">PLEASE WAIT FOR REWARD</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- QUIZ DATA ---
        const questions = [
            { q: "What is the capital of Canada?", a: ["Toronto", "Ottawa", "Vancouver", "Montreal"], correct: 1 },
            { q: "Which animal is a national symbol of Canada?", a: ["Eagle", "Beaver", "Lion", "Kangaroo"], correct: 1 },
            { q: "Canada has the longest _____ in the world.", a: ["River", "Coastline", "Bridge", "Road"], correct: 1 },
            { q: "What is Canada's national sport in winter?", a: ["Soccer", "Ice Hockey", "Basketball", "Skiing"], correct: 1 },
            { q: "How many time zones does Canada have?", a: ["3", "4", "5", "6"], correct: 3 }
        ];

        // --- STATE MANAGEMENT ---
        let currentQ = parseInt(localStorage.getItem('canada_q_idx')) || 0;
        let score = parseInt(localStorage.getItem('canada_score')) || 0;
        let points = parseInt(localStorage.getItem('canada_points')) || 0;

        const qText = document.getElementById('questionText');
        const oGrid = document.getElementById('optionsGrid');
        const scoreEl = document.getElementById('scoreVal');
        const pointsEl = document.getElementById('pointsVal');
        const adOverlay = document.getElementById('adOverlay');
        const timerDisplay = document.getElementById('timerDisplay');
        const phaseText = document.getElementById('phaseText');

        // Initial Load
        updateUI();
        loadQuestion();

        function updateUI() {
            scoreEl.innerText = score;
            pointsEl.innerText = points;
        }

        function loadQuestion() {
            const data = questions[currentQ % questions.length];
            qText.innerText = data.q;
            oGrid.innerHTML = '';
            data.a.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(index);
                oGrid.appendChild(btn);
            });
        }

        function handleAnswer(choice) {
            const data = questions[currentQ % questions.length];
            if (choice === data.correct) {
                score++;
                points += 10;
                localStorage.setItem('canada_score', score);
                localStorage.setItem('canada_points', points);
            }
            
            // Increment Question Index
            currentQ++;
            localStorage.setItem('canada_q_idx', currentQ);
            
            // Start Ad Phase
            startAdSequence();
        }

        function startAdSequence() {
            adOverlay.style.display = 'flex';
            
            // 1. Random Gap Time (2-4 seconds)
            const gapSeconds = Math.floor(Math.random() * 3) + 2;
            phaseText.innerText = `INITIALIZING GAP (${gapSeconds}s)`;
            
            let gapLeft = gapSeconds;
            const gapInterval = setInterval(() => {
                timerDisplay.innerText = gapLeft;
                gapLeft--;
                if(gapLeft < 0) {
                    clearInterval(gapInterval);
                    triggerMonetagAd();
                }
            }, 1000);
        }

        function triggerMonetagAd() {
            phaseText.innerText = "LOADING REWARD AD...";
            
            try {
                if (typeof show_10543114 === 'function') {
                    show_10543114().then(() => {
                        // This triggers when ad is closed
                    });

                    // 2. Random Ad Show Time (15-17 seconds)
                    const adViewSeconds = Math.floor(Math.random() * 3) + 15;
                    startCountdown(adViewSeconds);

                } else {
                    alert("Ad SDK not loaded. Please check internet.");
                    location.reload();
                }
            } catch (e) {
                location.reload();
            }
        }

        function startCountdown(seconds) {
            phaseText.innerText = "AD IS ACTIVE - DO NOT CLOSE";
            let timeLeft = seconds;

            const adInterval = setInterval(() => {
                timerDisplay.innerText = timeLeft < 10 ? `0${timeLeft}` : timeLeft;
                timeLeft--;

                if (timeLeft < 0) {
                    clearInterval(adInterval);
                    finishSequence();
                }
            }, 1000);
        }

        function finishSequence() {
            phaseText.innerText = "REWARD GRANTED!";
            setTimeout(() => {
                location.reload(); // Reload to refresh ad session and load next question
            }, 1000);
        }

    </script>
</body>
</html>
