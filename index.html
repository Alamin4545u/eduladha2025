<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Box Pro</title>
    <!-- Telegram Web App script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase Apps -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary-color: #007bff;
            --text-color: #333;
            --light-text: #777;
            --accent-color: #8a2be2;
            --btn-secondary-bg: #6c757d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0 0 70px 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-user-select: none;
            -ms-user-select: none; 
            user-select: none; 
        }

        .container { padding: 15px; }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .user-info { display: flex; align-items: center; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background-color: var(--accent-color); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; margin-right: 10px; }
        .user-details h4, .user-details p { margin: 0; }
        .user-details h4 { font-size: 16px; }
        .user-details p { font-size: 13px; color: var(--light-text); }
        .balance { text-align: right; }
        .balance p { margin: 0; color: var(--light-text); font-size: 14px; }
        .balance h3 { margin: 0; color: var(--primary-color); font-size: 22px; }

        .welcome-banner { background: linear-gradient(135deg, #e0f7fa, #b2ebf2); border-radius: 12px; padding: 20px; text-align: left; margin-bottom: 20px; }
        .welcome-banner h2 { margin: 0 0 5px 0; }
        .welcome-banner p { margin: 0; color: #00796b; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .stat-card, .card { background-color: var(--card-bg); border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .stat-card p { margin: 0 0 8px 0; color: var(--light-text); font-size: 14px; }
        .stat-card h3 { margin: 0; font-size: 20px; }
        .stat-card.full-width { grid-column: 1 / -1; }
        
        .progress-bar { width: 100%; background-color: #e0e0e0; border-radius: 8px; height: 8px; overflow: hidden; margin-top: 10px; }
        .progress-bar-inner { height: 100%; background-color: var(--primary-color); border-radius: 8px; transition: width 0.3s ease; }
        
        .card h3, .card h2, .card h4 { margin-top: 0; }
        .referral-item { display: flex; align-items: center; background-color: #f0f8ff; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .referral-item span { margin-left: 10px; }
        .referral-link { background-color: #e9ecef; padding: 12px; border-radius: 8px; word-wrap: break-word; font-family: monospace; margin-bottom: 15px; text-align: center; }
        
        .btn { display: block; width: 100%; padding: 12px; border: none; border-radius: 8px; background-color: var(--primary-color); color: white; font-size: 16px; font-weight: bold; text-align: center; cursor: pointer; box-sizing: border-box; text-decoration: none; }
        .btn-secondary { background-color: var(--btn-secondary-bg); }
        
        .task-card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .task-header h4, .task-header .reward { margin: 0; }
        .task-header h4 { font-size: 16px; }
        .task-header .reward { font-size: 16px; font-weight: bold; color: var(--primary-color); }
        .task-body p { color: var(--light-text); font-size: 14px; margin: 10px 0; }
        .btn.disabled, .btn:disabled { background-color: #ced4da; cursor: not-allowed; opacity: 0.7; }

        .page { display: none; }
        .page.active { display: block; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; background-color: var(--card-bg); box-shadow: 0 -2px 10px rgba(0,0,0,0.1); padding: 5px 0; border-top: 1px solid #eee; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--light-text); padding: 5px 15px; cursor: pointer; border-radius: 10px; transition: background-color 0.3s, color 0.3s; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; }
        .nav-item span { font-size: 12px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 16px; }
        .payment-method { position: relative; }
        .payment-method .logo { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; }
        .payment-method select { padding-left: 40px; }
        
        .history-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .history-item:last-child { border-bottom: none; }
        .history-item .status { padding: 4px 8px; border-radius: 12px; font-size: 12px; color: white; text-transform: capitalize; }
        .history-item .status.pending { background-color: #ffc107; }
        .history-item .status.completed { background-color: #28a745; }
        .history-item .status.rejected { background-color: #dc3545; }
        
        /* VPN Modal Styles */
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border-radius: 12px; width: 85%; max-width: 400px; text-align: center; }
        .modal-content h3 { margin-top: 0; }
        .modal-content p { margin-bottom: 15px; }
    </style>
</head>
<body>

    <!-- Pages -->
    <div id="home-page" class="page active"><div class="container"><div class="header"><div class="user-info"><div class="avatar" id="user-avatar">?</div><div class="user-details"><h4 id="user-name">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h4><p id="user-username">@‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div></div><div class="balance"><p>‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h3 id="available-balance">‡ß≥‡ß¶.‡ß¶‡ß¶</h3></div></div><div class="welcome-banner"><h2>üëã ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡¶§‡ßá ‡¶ï‡¶æ‡¶ú‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div><div class="stats-grid"><div class="stat-card"><p>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p><h3 id="total-earnings">‡ß≥‡ß¶.‡ß¶‡ß¶</h3></div><div class="stat-card"><p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</p><h3 id="referrals">‡ß¶</h3></div><div class="stat-card full-width"><p>‡¶Ö‡¶∞‡ßç‡¶ú‡¶ø‡¶§ ‡¶ï‡¶Æ‡¶ø‡¶∂‡¶®</p><h3>‡ß≥‡ß¶.‡ß¶‡ß¶</h3></div></div><div class="card"><h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</h3><p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ‡ß´‡ß¶‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®</p><div class="progress-bar"><div id="daily-progress-bar" class="progress-bar-inner"></div></div><small id="daily-progress-text">‡¶Ü‡¶ú: ‡ß¶/‡ß´‡ß¶</small></div><br><div class="card"><h3>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</h3><div class="referral-item"><span>üéÅ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶∞‡¶æ ‡¶™‡¶æ‡¶¨‡ßá <strong id="join-bonus-text">‡ß®‡ß¶ ‡ß≥</strong> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div><div class="referral-item"><span>üíµ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá <strong id="ref-bonus-text">‡ß´ ‡ß≥</strong> ‡¶™‡¶æ‡¶¨‡ßá‡¶®</span></div><p style="margin-top: 15px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:</p><div class="referral-link" id="referral-link">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div><button class="btn" id="share-btn">‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div></div>
    <div id="tasks-page" class="page"><div class="container"><h2>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® üéÅ</h2><div class="task-card"><div class="task-header"><div><h4>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h4></div><span class="reward" id="ad-reward-text">‡ß≥‡ß¶.‡ß´‡ß¶</span></div><div class="task-body"><p>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ‡¶õ‡ßã‡¶ü ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p></div><button class="btn" id="watch-ad-btn">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button></div><div id="survey-tasks-container"></div></div></div>
    <div id="support-page" class="page" style="text-align:center; padding-top: 50px;"><div class="container"><svg style="width:80px; height:80px; color: var(--primary-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><h2>‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®?</h2><p>‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p><br><button id="contact-support-btn" class="btn">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>
    <div id="withdraw-page" class="page"><div class="container"><h2>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h2><div class="card"><h4>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ</h4><div><label>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ <span id="min-withdraw-req-text">‡ßß‡ßß‡ß¶</span> ‡ß≥ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (<span id="balance-progress-text">‡ß¶/‡ßß‡ßß‡ß¶</span>)</label><div class="progress-bar"><div class="progress-bar-inner" id="balance-progress-bar" style="width: 0%;"></div></div></div></div><div id="withdraw-requirement-notice" class="card" style="margin-top:15px; background-color: #ffebee; color: #c62828; text-align: center;">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ßß‡ßß‡ß¶ ‡ß≥ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§</div><div class="card" style="margin-top: 15px;"><div class="form-group"><label for="payment-method">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</label><div class="payment-method"><img id="payment-logo" src="" class="logo"><select id="payment-method"></select></div></div><div class="form-group"><label for="account-number">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø</label><input type="text" id="account-number" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></div><div class="form-group"><label for="amount">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label><input type="number" id="amount" placeholder="‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ‡ßß‡ßß‡ß¶.‡ß¶‡ß¶, ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö: ‡ß®‡ß¶‡ß¶‡ß¶.‡ß¶‡ß¶"></div><button id="submit-withdraw-btn" class="btn">‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button></div><div class="card" style="margin-top: 15px;"><h4>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h4><div id="withdrawal-history"><p style="text-align: center; color: var(--light-text);">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p></div></div></div></div>

    <!-- VPN Check Modal -->
    <div id="vpn-modal" class="modal"><div class="modal-content"><h3>VPN ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</h3><p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶§‡ßá, ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¶‡ßá‡¶∂‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø‡¶∞ VPN ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá:</p><strong id="allowed-countries-list">US, UK, Canada</strong><br><br><button id="close-vpn-modal-btn" class="btn btn-secondary">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>
    
    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-page="home-page"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg><span>‡¶π‡ßã‡¶Æ</span></div>
        <div class="nav-item" data-page="tasks-page"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></div>
        <div class="nav-item" data-page="support-page"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg><span>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</span></div>
        <div class="nav-item" data-page="withdraw-page"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 6a2 2 0 00-2 2v2a2 2 0 002 2h12a2 2 0 002-2v-2a2 2 0 00-2-2H4z" clip-rule="evenodd"></path></svg><span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span></div>
    </nav>
    
<script>
    // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ---
    const firebaseConfig = {
        apiKey: "AIzaSyBidXnyxl4LjnRW6z5PrQ_iOKzqjjrxRtM",
        authDomain: "comexaple.firebaseapp.com",
        projectId: "comexaple",
        storageBucket: "comexaple.appspot.com",
        messagingSenderId: "799294329351",
        appId: "1:799294329351:web:0bb9620bc1d227a29650a2",
        measurementId: "G-LRBREF5QV6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;

    document.addEventListener('DOMContentLoaded', function () {
        tg.ready();
        
        let currentUserData = {};
        let appSettings = {};
        let teleUser;
        
        const user = tg.initDataUnsafe.user;

        if (!user || Object.keys(user).length === 0) {
            teleUser = { id: '5788008001', first_name: 'Test', last_name: 'User', username: 'testuser' };
            console.warn("‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§");
        } else {
             teleUser = user;
        }

        async function initializeApp() {
            try {
                const settingsDoc = await db.collection('settings').doc('appConfig').get();
                if (settingsDoc.exists) {
                    appSettings = settingsDoc.data();
                } else {
                    appSettings = {
                        minWithdraw: 110, referralBonus: 5, joinBonus: 20, adReward: 0.50, surveyReward: 1.0, surveyAdsNeeded: 10,
                        supportLink: 'https://t.me/your_support_contact',
                        botUsername: 'YourBotName_bot', // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
                        gigapubAppId: "4203",
                        vpnCheckEnabled: true,
                        allowedCountries: "US,UK,CA",
                        paymentMethods: [
                            { name: '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂', logo: 'https://i.ibb.co/L0f5bXN/bkash.png' },
                            { name: '‡¶®‡¶ó‡¶¶', logo: 'https://i.ibb.co/qYdG2sW/nagad.png' }
                        ]
                    };
                }
                loadGigapubScript(appSettings.gigapubAppId);
                loadPaymentMethods(appSettings.paymentMethods);
                await loadUserData();
            } catch (error) {
                console.error("Initialization error:", error);
                tg.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
        }
        
        function loadGigapubScript(appId) {
            if (!appId || document.querySelector(`script[src*="${appId}"]`)) return;
            const script = document.createElement('script');
            script.src = `https://ad.gigapub.tech/script?id=${appId}`;
            document.body.appendChild(script);
        }

        function loadPaymentMethods(methods) {
            const select = document.getElementById('payment-method');
            select.innerHTML = '';
            methods.forEach(method => {
                const option = document.createElement('option');
                option.value = method.name; option.textContent = method.name; option.dataset.logo = method.logo;
                select.appendChild(option);
            });
            updatePaymentMethodUI();
        }
        
        async function loadUserData() {
            const fullName = `${teleUser.first_name || ''} ${teleUser.last_name || ''}`.trim();
            document.getElementById('user-name').textContent = fullName;
            document.getElementById('user-username').textContent = teleUser.username ? `@${teleUser.username}` : 'N/A';
            document.getElementById('user-avatar').textContent = (fullName[0] || '?').toUpperCase();
            
            const userRef = db.collection('users').doc(String(teleUser.id));
            const doc = await userRef.get();

            if (!doc.exists) {
                const initialSurveyProgress = {};
                for(let i=1; i<=10; i++) { initialSurveyProgress[`survey_${i}`] = 0; }
                await userRef.set({
                    username: teleUser.username, fullName: fullName, balance: appSettings.joinBonus, totalEarnings: appSettings.joinBonus,
                    referrals: 0, adsWatchedToday: 0, lastAdWatch: null, surveyProgress: initialSurveyProgress
                });
                const newDoc = await userRef.get();
                currentUserData = newDoc.data();
            } else {
                currentUserData = doc.data();
            }
            updateUI(currentUserData);
            loadWithdrawalHistory();
        }
        
        function updateUI(data) {
            document.getElementById('available-balance').textContent = `‡ß≥${(data.balance || 0).toFixed(2)}`;
            document.getElementById('total-earnings').textContent = `‡ß≥${(data.totalEarnings || 0).toFixed(2)}`;
            document.getElementById('referrals').textContent = data.referrals || 0;
            
            const botUsername = appSettings.botUsername || 'YourBotName_bot';
            const referralLink = `https://t.me/${botUsername}?startapp=${teleUser.id}`;
            document.getElementById('referral-link').textContent = referralLink;

            document.getElementById('join-bonus-text').textContent = `${appSettings.joinBonus} ‡ß≥`;
            document.getElementById('ref-bonus-text').textContent = `${appSettings.referralBonus} ‡ß≥`;
            document.getElementById('ad-reward-text').textContent = `‡ß≥${(appSettings.adReward || 0).toFixed(2)}`;
            
            const adsWatched = data.adsWatchedToday || 0;
            document.getElementById('daily-progress-bar').style.width = `${(adsWatched / 50) * 100}%`;
            document.getElementById('daily-progress-text').textContent = `‡¶Ü‡¶ú: ${adsWatched}/50`;
            
            updateWithdrawUI(data.balance);
            renderSurveyTasks(data.surveyProgress || {});
        }

        function updateWithdrawUI(balance) {
             const minBalance = appSettings.minWithdraw || 110;
             const balanceProgress = Math.min((balance / minBalance) * 100, 100);
             document.getElementById('min-withdraw-req-text').textContent = minBalance;
             document.getElementById('balance-progress-text').textContent = `${balance.toFixed(0)}/${minBalance}`;
             document.getElementById('balance-progress-bar').style.width = `${balanceProgress}%`;
             document.getElementById('amount').placeholder = `‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ${minBalance.toFixed(2)}, ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö: ${(appSettings.maxWithdraw || 2000).toFixed(2)}`;
             const withdrawNotice = document.getElementById('withdraw-requirement-notice');
             const submitBtn = document.getElementById('submit-withdraw-btn');
             if(balance >= minBalance) {
                withdrawNotice.style.display = 'none'; submitBtn.disabled = false;
             } else {
                withdrawNotice.style.display = 'block'; withdrawNotice.textContent = `‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ${minBalance} ‡ß≥ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`; submitBtn.disabled = true;
             }
        }
        
        function renderSurveyTasks(progress) {
            const container = document.getElementById('survey-tasks-container');
            container.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const currentProgress = progress[`survey_${i}`] || 0;
                const adsNeeded = appSettings.surveyAdsNeeded || 10;
                const isCompleted = currentProgress >= adsNeeded;
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card';
                taskCard.innerHTML = `<div class="task-header"><div><h4>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶ï‡¶∞‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶® ${i}</h4></div><span class="reward">‡ß≥${(appSettings.surveyReward || 1).toFixed(2)}</span></div><div class="task-body"><p>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ${adsNeeded}‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§ (${currentProgress}/${adsNeeded} ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®)</p></div><button class="btn survey-btn" data-survey-id="${i}" ${isCompleted ? 'disabled' : ''}>${isCompleted ? '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®' : '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®'}</button>`;
                container.appendChild(taskCard);
            }
            document.querySelectorAll('.survey-btn').forEach(button => button.addEventListener('click', () => handleAdWatchWithReward(appSettings.surveyReward, button.dataset.surveyId)));
        }

        async function checkVPN() {
            if (!appSettings.vpnCheckEnabled) return true;
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) throw new Error('Network response was not ok.');
                const data = await response.json();
                const userCountry = data.country_code;
                const allowed = (appSettings.allowedCountries || "US,UK,CA").split(',');

                if (allowed.includes(userCountry)) {
                    return true;
                } else {
                    document.getElementById('allowed-countries-list').textContent = appSettings.allowedCountries;
                    document.getElementById('vpn-modal').style.display = 'flex';
                    return false;
                }
            } catch (error) {
                console.error("VPN check error:", error);
                tg.showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return false;
            }
        }

        async function handleAdWatchWithReward(reward, surveyId = null) {
             if (typeof window.showGiga !== 'function') { tg.showAlert('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§'); return; }
            try {
                await window.showGiga();
                const userRef = db.collection('users').doc(String(teleUser.id));
                await db.runTransaction(async (transaction) => {
                    const userDoc = await transaction.get(userRef);
                    if (!userDoc.exists) throw "User not found";
                    const data = userDoc.data();
                    let updateData = {};
                    
                    if (surveyId) { // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
                        const surveyProgress = data.surveyProgress || {};
                        const currentProgress = (surveyProgress[`survey_${surveyId}`] || 0) + 1;
                        updateData[`surveyProgress.survey_${surveyId}`] = currentProgress;
                        if (currentProgress >= (appSettings.surveyAdsNeeded || 10)) {
                             updateData.balance = (data.balance || 0) + (appSettings.surveyReward || 1);
                             updateData.totalEarnings = (data.totalEarnings || 0) + (appSettings.surveyReward || 1);
                        }
                    } else { // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
                        updateData.balance = (data.balance || 0) + reward;
                        updateData.totalEarnings = (data.totalEarnings || 0) + reward;
                        updateData.adsWatchedToday = (data.adsWatchedToday || 0) + 1;
                    }
                    transaction.update(userRef, updateData);
                });
                tg.HapticFeedback.notificationOccurred('success');
                await loadUserData();
            } catch (e) {
                console.error("Ad or transaction error:", e);
                if(e && e.message !== "Ad was closed by user") tg.showAlert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
        }
        
        document.getElementById('watch-ad-btn').addEventListener('click', () => handleAdWatchWithReward(appSettings.adReward));

        async function loadWithdrawalHistory() {
            const historyContainer = document.getElementById('withdrawal-history');
            historyContainer.innerHTML = '<p style="text-align:center;color:var(--light-text);">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            const querySnapshot = await db.collection('withdrawals').where('userId', '==', teleUser.id).orderBy('timestamp', 'desc').limit(10).get();
            if (querySnapshot.empty) {
                historyContainer.innerHTML = '<p style="text-align:center;color:var(--light-text);">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>'; return;
            }
            historyContainer.innerHTML = '';
            querySnapshot.forEach(doc => {
                const data = doc.data();
                const date = data.timestamp ? data.timestamp.toDate().toLocaleDateString('bn-BD') : 'N/A';
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `<div><strong>‡ß≥${data.amount.toFixed(2)}</strong> - ${data.method}<div style="font-size:12px;color:#777;">${date}</div></div><span class="status ${data.status}">${data.status}</span>`;
                historyContainer.appendChild(item);
            });
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', async () => {
                const pageId = item.dataset.page;
                if (pageId === 'tasks-page') {
                    const isVpnOk = await checkVPN();
                    if (!isVpnOk) return; // VPN ‡¶†‡¶ø‡¶ï ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡ßá‡¶ú ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
                }
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
            });
        });
        
        document.getElementById('close-vpn-modal-btn').addEventListener('click', () => {
            document.getElementById('vpn-modal').style.display = 'none';
        });

        document.getElementById('share-btn').addEventListener('click', () => {
            const referralLink = document.getElementById('referral-link').textContent;
            const shareText = `üí∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶™‡ßç‡¶∞‡ßã-‡¶§‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®!\n\n‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ${appSettings.joinBonus} ‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®!\n\n‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:\n${referralLink}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(shareText)}`);
        });

        document.getElementById('contact-support-btn').addEventListener('click', () => tg.openTelegramLink(appSettings.supportLink));
        
        const paymentMethodSelect = document.getElementById('payment-method');
        paymentMethodSelect.addEventListener('change', updatePaymentMethodUI);

        function updatePaymentMethodUI() {
            const selectedOption = paymentMethodSelect.selectedOptions[0];
            if (!selectedOption) return;
            document.getElementById('payment-logo').src = selectedOption.dataset.logo;
            document.getElementById('account-number').placeholder = `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ${selectedOption.textContent} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®`;
        }
        
        document.getElementById('submit-withdraw-btn').addEventListener('click', async (e) => {
             e.currentTarget.disabled = true;
             const method = document.getElementById('payment-method').value, number = document.getElementById('account-number').value, amount = parseFloat(document.getElementById('amount').value);
             if (!number || !amount) { tg.showAlert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); e.currentTarget.disabled = false; return; }
             if (amount < appSettings.minWithdraw) { tg.showAlert(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ${appSettings.minWithdraw} ‡ß≥‡•§`); e.currentTarget.disabled = false; return; }
             const userRef = db.collection('users').doc(String(teleUser.id));
             const doc = await userRef.get();
             if (amount > doc.data().balance) { tg.showAlert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§'); e.currentTarget.disabled = false; return; }
             await db.collection('withdrawals').add({
                 userId: teleUser.id, username: teleUser.username, amount: amount, method: method, number: number,
                 status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp()
             });
             await userRef.update({ balance: doc.data().balance - amount });
             tg.showPopup({ title: '‡¶∏‡¶´‡¶≤', message: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', buttons: [{type: 'close'}] });
             await loadUserData();
             document.getElementById('account-number').value = ''; document.getElementById('amount').value = '';
             e.currentTarget.disabled = false;
        });

        initializeApp();
    });
</script>
</body>
</html>
