<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Gigapub Ad Network Script -->
    <script src="https://ad.gigapub.tech/script?id=4203"></script>

    <style>
        /* CSS Code Starts Here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --primary-color: #2a2a72;
            --secondary-color: #009ffd;
            --background-color: #f0f2f5;
            --text-color: #333;
            --card-bg: #ffffff;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            padding: 15px;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .profile-section {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        #user-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            margin-right: 15px;
        }

        .user-details p {
            margin: 0;
            font-weight: 600;
        }

        #user-username {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }

        .balance-card p {
            margin: 0;
        }

        .balance-amount {
            font-size: 1.8em;
            font-weight: 700;
        }

        /* Ad Containers */
        .ad-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            color: #999;
        }

        /* Task Buttons */
        .task-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .task-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1em;
            font-weight: 600;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 0 #ccc;
        }

        .task-btn i {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .task-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #ccc;
        }

        .start-task { background-color: #e74c3c; box-shadow: 0 5px 0 #c0392b; }
        .spin-earn { background-color: #3498db; box-shadow: 0 5px 0 #2980b9; }
        .scratch-card { background-color: #9b59b6; box-shadow: 0 5px 0 #8e44ad; }
        .wallet { background-color: #2ecc71; box-shadow: 0 5px 0 #27ae60; }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--card-bg);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            padding: 10px 0;
            text-decoration: none;
            color: #999;
            transition: color 0.3s, background-color 0.3s;
        }

        .nav-item i {
            font-size: 1.5em;
            margin-bottom: 3px;
        }

        .nav-item span {
            font-size: 0.8em;
        }

        .nav-item.active {
            color: var(--primary-color);
        }
        /* CSS Code Ends Here */
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <div class="profile-section">
                <img id="user-photo" src="https://i.ibb.co/2k11yV0/user.png" alt="User Photo">
                <div class="user-details">
                    <p id="user-name">Your Name</p>
                    <p id="user-username">@username</p>
                </div>
            </div>
            <div class="balance-card">
                <p>Balance</p>
                <p class="balance-amount"><i class="fas fa-coins"></i> <span id="balance">1250</span></p>
            </div>
        </header>

        <!-- Main Content Section -->
        <main class="main-content">
            <!-- Adextra Ad Network Placeholder -->
            <div id="adextra-ad-container" class="ad-container">
                <!-- Adextra Ad Code Goes Here -->
                <p>Adextra Ad Placeholder</p>
            </div>

            <!-- Task Buttons -->
            <div class="task-section">
                <button class="task-btn start-task">
                    <i class="fas fa-rocket"></i> Start Task
                </button>
                <button class="task-btn spin-earn">
                    <i class="fas fa-sync-alt"></i> Spin & Earn
                </button>
                <button class="task-btn scratch-card">
                    <i class="fas fa-scratch"></i> Scratch Card
                </button>
                <button class="task-btn wallet">
                    <i class="fas fa-wallet"></i> Wallet
                </button>
            </div>
        </main>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" data-page="withdraw">
                <i class="fas fa-money-bill-wave"></i>
                <span>Withdraw</span>
            </a>
            <a href="#" class="nav-item" data-page="referral">
                <i class="fas fa-user-friends"></i>
                <span>Referral</span>
            </a>
            <a href="#" class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </nav>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script>
        // JavaScript Code Starts Here
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase Configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBidXnyxl4LjnRW6z5PrQ_iOKzqjjrxRtM",
                authDomain: "comexaple.firebaseapp.com",
                projectId: "comexaple",
                storageBucket: "comexaple.firebasestorage.app",
                messagingSenderId: "799294329351",
                appId: "1:799294329351:web:0bb9620bc1d227a29650a2",
                measurementId: "G-LRBREF5QV6"
            };

            // Initialize Firebase
            try {
                firebase.initializeApp(firebaseConfig);
                firebase.analytics();
                console.log("Firebase initialized successfully.");
            } catch (e) {
                console.error("Firebase initialization failed:", e);
            }

            // Initialize Telegram Web App
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand(); // Expand the app to full height

            // Fetch and display user data
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                const userPhotoEl = document.getElementById('user-photo');
                const userNameEl = document.getElementById('user-name');
                const userUsernameEl = document.getElementById('user-username');

                if (user.photo_url) {
                    userPhotoEl.src = user.photo_url;
                }
                userNameEl.textContent = `${user.first_name} ${user.last_name || ''}`.trim();
                if (user.username) {
                    userUsernameEl.textContent = `@${user.username}`;
                } else {
                    userUsernameEl.textContent = 'No username';
                }
            } else {
                console.log("User data not available.");
            }

            // --- Ad Network Integration ---
            // Adextra Ad code should be placed in the placeholder div in the HTML body.
            
            // --- Event Listeners for Buttons ---

            // "Start Task" button will trigger the Gigapub Ad
            document.querySelector('.start-task').addEventListener('click', function() {
                console.log("'Start Task' clicked. Trying to show Gigapub ad.");
                if (window.showGiga) {
                    window.showGiga()
                        .then(() => {
                            console.log("Ad shown successfully. Implement your reward logic here.");
                            // Example: Show a success message
                            tg.showPopup({
                                title: 'Task Complete!',
                                message: 'You have been rewarded.',
                                buttons: [{type: 'ok'}]
                            });
                        })
                        .catch(e => {
                            console.error("Ad could not be shown:", e);
                            // Example: Show an error message
                            tg.showPopup({
                                title: 'Error',
                                message: 'Ad could not be loaded. Please try again later.',
                                buttons: [{type: 'ok'}]
                            });
                        });
                } else {
                    console.error("showGiga function not found.");
                    tg.showAlert("Ad function is not available yet. Please wait a moment and try again.");
                }
            });

            // Other Task Buttons
            document.querySelectorAll('.task-btn:not(.start-task)').forEach(button => {
                button.addEventListener('click', function() {
                    const taskName = this.innerText;
                    tg.showPopup({
                        title: 'Task Clicked',
                        message: `You clicked on ${taskName}.`,
                        buttons: [{type: 'ok', text: 'Got it!'}]
                    });
                });
            });

            // Navigation Buttons
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(event) {
                    event.preventDefault();
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    const page = this.dataset.page;
                    console.log(`Navigated to ${page} page.`);
                    // You can add logic here to show/hide different content based on the selected page
                });
            });
        });
        // JavaScript Code Ends Here
    </script>
</body>
</html>
